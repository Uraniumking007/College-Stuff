<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX Database Demo - Practical 15</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .demo-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        margin: 10px 0;
        overflow-x: auto;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
      }
      h1,
      h2 {
        color: #333;
      }
      .btn {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0056b3;
      }
      .result {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        max-height: 300px;
        overflow-y: auto;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .json-result {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        font-family: monospace;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>Practical 15: AJAX Database Table Retrieval Demo</h1>

    <div class="demo-section">
      <h2>Key Features Implemented</h2>
      <ul>
        <li>
          <strong>AJAX Table Retrieval:</strong> Fetch table data from database
          without page reload
        </li>
        <li>
          <strong>Dynamic Table Selection:</strong> Choose from multiple
          database tables
        </li>
        <li>
          <strong>Search Functionality:</strong> Search across all columns in
          real-time
        </li>
        <li>
          <strong>Pagination:</strong> Navigate through large datasets
          efficiently
        </li>
        <li>
          <strong>Column Sorting:</strong> Sort data by any column in
          ascending/descending order
        </li>
        <li>
          <strong>Responsive Design:</strong> Works on desktop and mobile
          devices
        </li>
        <li>
          <strong>Error Handling:</strong> Comprehensive error handling and user
          feedback
        </li>
      </ul>
    </div>

    <div class="demo-section">
      <h2>AJAX Implementation</h2>
      <p>The core AJAX functionality for retrieving table data:</p>

      <div class="code-block">
        <pre><code>function loadTableData() {
    const params = {
        table: currentTable,
        page: currentPage,
        limit: currentLimit,
        search: currentSearch,
        sort: currentSort,
        order: currentOrder
    };

    $.ajax({
        url: 'fetch_table_data.php',
        type: 'GET',
        data: params,
        dataType: 'json',
        timeout: 10000,
        success: function(response) {
            if (response.success) {
                displayTableData(response);
            } else {
                showError('Error: ' + response.message);
            }
        },
        error: function(xhr, status, error) {
            showError('Failed to load data: ' + error);
        }
    });
}</code></pre>
      </div>
    </div>

    <div class="demo-section">
      <h2>Server Response Format</h2>
      <p>The PHP backend returns structured JSON responses:</p>
      <div class="code-block">
        <pre><code>{
    "success": true,
    "message": "Data retrieved successfully",
    "data": [
        {
            "id": "1",
            "name": "John Doe",
            "email": "john.doe@email.com",
            "age": "28",
            "city": "New York",
            "department": "IT",
            "salary": "$75,000.00"
        }
    ],
    "total_records": 8,
    "table_info": [
        {
            "name": "id",
            "type": "int(11)",
            "key": "PRI"
        }
    ],
    "pagination": {
        "current_page": 1,
        "total_pages": 1,
        "per_page": 10,
        "has_next": false,
        "has_prev": false
    }
}</code></pre>
      </div>
    </div>

    <div class="demo-section">
      <h2>Test AJAX Database Retrieval</h2>
      <p>Click the buttons below to test different AJAX requests:</p>

      <button class="btn" onclick="testAjaxRequest('users', 1, 5)">
        Get Users (5 records)
      </button>
      <button class="btn" onclick="testAjaxRequest('products', 1, 3)">
        Get Products (3 records)
      </button>
      <button class="btn" onclick="testAjaxRequest('departments', 1, 10)">
        Get Departments
      </button>
      <button class="btn" onclick="testAjaxRequest('orders', 1, 5)">
        Get Orders (5 records)
      </button>

      <div id="testResult" class="result" style="display: none"></div>
    </div>

    <div class="demo-section">
      <h2>Database Tables Available</h2>
      <ul>
        <li>
          <strong>users:</strong> User information with name, email, age, city,
          department, and salary
        </li>
        <li>
          <strong>products:</strong> Product catalog with name, category, price,
          stock, and description
        </li>
        <li>
          <strong>orders:</strong> Order records linking users and products with
          quantities and status
        </li>
        <li>
          <strong>departments:</strong> Department information with manager,
          budget, and location
        </li>
      </ul>
    </div>

    <div class="demo-section">
      <h2>Files Created</h2>
      <ul>
        <li>
          <strong>table_viewer.html:</strong> Main interface with AJAX table
          viewer
        </li>
        <li>
          <strong>fetch_table_data.php:</strong> PHP backend to retrieve table
          data
        </li>
        <li>
          <strong>database_setup.php:</strong> Database setup script with sample
          data
        </li>
        <li><strong>demo.html:</strong> This demonstration file</li>
      </ul>
    </div>

    <div class="demo-section">
      <h2>How to Use</h2>
      <ol>
        <li>
          First, run <code>database_setup.php</code> to create the database and
          sample data
        </li>
        <li>Open <code>table_viewer.html</code> in a web browser</li>
        <li>Select a table from the dropdown</li>
        <li>Use search, pagination, and sorting features</li>
        <li>Check the browser's Network tab to see AJAX requests</li>
      </ol>
    </div>

    <script>
      function testAjaxRequest(table, page, limit) {
        var resultDiv = $("#testResult");
        resultDiv.show().removeClass("success error json-result");

        var params = {
          table: table,
          page: page,
          limit: limit,
        };

        $.ajax({
          url: "fetch_table_data.php",
          type: "GET",
          data: params,
          dataType: "json",
          timeout: 5000,
          success: function (response) {
            resultDiv.addClass("success json-result");
            resultDiv.html(
              "<strong>Success!</strong>\n\n" +
                JSON.stringify(response, null, 2)
            );
          },
          error: function (xhr, status, error) {
            resultDiv.addClass("error");
            resultDiv.html(
              "<strong>Error!</strong><br>" +
                "Status: " +
                status +
                "<br>" +
                "Error: " +
                error +
                "<br>" +
                "Response: " +
                xhr.responseText
            );
          },
        });
      }
    </script>
  </body>
</html>
